# TTS音频生成和配音管理

## 基础TTS音频生成能力
系统 SHALL 支持基础的TTS音频生成功能，能够将文本转换为语音并保存为音频文件。

### Requirement: 基础TTS生成
系统 SHALL 提供将文本转换为音频的基本功能。

#### Scenario: 基础文本转语音
- **WHEN** 提供有效的文本内容和输出路径
- **THEN** 生成对应的音频文件并保存到指定路径

## 增强的TTS音频生成能力
系统 SHALL 支持带有参考音频的TTS音频生成功能，并提供动态文件列表更新。

### Requirement: TTS音频生成函数增强
系统 SHALL 支持带有参考音频的TTS音频生成功能，并提供动态文件列表更新。

#### Scenario: 集成参考音频的TTS生成
- **WHEN** 调用TTS生成函数时提供参考音频路径
- **THEN** 使用参考音频的音色和风格生成新的TTS音频

#### Scenario: 动态音频文件列表更新
- **WHEN** TTS生成完成后
- **THEN** 自动重新扫描音频目录并更新下拉选择列表

### Requirement: 重新生成配音功能增强
系统 SHALL 提供精确的重新生成选中配音功能，支持文案和诗词的分别重新生成。

#### Scenario: 增强的重新生成逻辑
- **WHEN** 用户点击重新生成按钮并选择了音频文件
- **THEN** 系统根据文件名格式判断是文案还是诗词，并执行对应的重新生成逻辑

#### Scenario: 选择验证和错误处理
- **WHEN** 用户未选择有效的音频文件
- **THEN** 系统返回空值或错误提示，不执行重新生成操作

## 参考音频选择功能
系统 SHALL 提供参考音频文件选择和试听功能，使用户能够控制TTS生成的音色和风格。

### Requirement: 参考音频选择功能
系统 SHALL 提供参考音频文件选择和试听功能，使用户能够控制TTS生成的音色和风格。

#### Scenario: 动态加载参考音频文件列表
- **WHEN** material/reference_audio 目录存在且包含音频文件
- **THEN** 下拉列表显示"请选择"以及所有可用的参考音频文件

#### Scenario: 试听参考音频
- **WHEN** 用户从参考音频下拉列表中选择文件
- **THEN** 音频播放器自动加载并播放选中的参考音频文件

#### Scenario: 无参考音频文件处理
- **WHEN** material/reference_audio 目录不存在或为空
- **THEN** 下拉列表显示"请选择"和"未找到参考音频文件"提示

## 精确文本重新生成功能
系统 SHALL 提供文案和诗词文本的精确重新生成功能，支持基于选择ID的单独重新生成。

### Requirement: 精确文案文本重新生成
系统 SHALL 提供文案文本的精确重新生成功能，支持基于选择ID的单独重新生成。

#### Scenario: 文案文本重新生成
- **WHEN** 用户选择以"wenan_"开头的音频文件并点击重新生成
- **THEN** 系统提取文件ID并重新生成对应的文案文本片段

#### Scenario: 文案重新生成音频试听
- **WHEN** 文案重新生成完成
- **THEN** TTS下拉列表自动更新，包含新生成的音频文件

### Requirement: 坐标式诗词重新生成
系统 SHALL 提供基于坐标的诗词文本重新生成功能，支持上下句的独立重新生成。

#### Scenario: 诗词上句重新生成
- **WHEN** 用户选择特定诗词ID并指定上句坐标
- **THEN** 系统重新生成该诗词的上句配音

#### Scenario: 诗词下句重新生成
- **WHEN** 用户选择特定诗词ID并指定下句坐标
- **THEN** 系统重新生成该诗词的下句配音