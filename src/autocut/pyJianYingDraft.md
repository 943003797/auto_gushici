# pyJianYingDraft API 参考文档

## 1. 草稿管理

### 1.1 DraftFolder 类

`DraftFolder` 是 pyJianYingDraft 库的入口类，用于管理剪映草稿文件夹，提供草稿的创建、复制、查询和删除等文件系统级别的操作。该类封装了剪映草稿目录的底层结构，使得开发者无需直接处理复杂的 JSON 文件和子目录组织。

#### 1.1.1 构造函数

```python
DraftFolder(path: str)
```

| 参数     | 类型    | 必填 | 说明                                                                                                                                       |
| :------- | :------ | :--- | :----------------------------------------------------------------------------------------------------------------------------------------- |
| `path` | `str` | 是   | 剪映草稿文件夹的**绝对路径**，通常为 `%LOCALAPPDATA%\JianyingPro\User Data\Projects\com.lveditor.draft`（Windows）或用户自定义位置 |

**返回值**：`DraftFolder` 实例

**路径获取方式**：剪映草稿文件夹的默认位置因操作系统和安装方式而异。在 Windows 系统上，可通过文件资源管理器地址栏输入 `%LOCALAPPDATA%\JianyingPro` 快速定位。若使用自定义安装路径或便携版剪映，需在设置中查看实际的草稿存储位置。构造函数本身不会验证路径有效性，但后续操作会在该路径下创建实际的文件结构，路径无效时将引发 `FileNotFoundError` 或权限相关异常。

#### 1.1.2 核心方法

##### `create_draft(name, width, height, allow_replace=True)`

创建一个新的剪映草稿项目，生成完整的草稿文件结构。

| 参数              | 类型     | 必填 | 默认值   | 说明                                                                                                   |
| :---------------- | :------- | :--- | :------- | :----------------------------------------------------------------------------------------------------- |
| `name`          | `str`  | 是   | -        | 草稿名称，将作为子文件夹名和剪映界面中显示的项目名                                                     |
| `width`         | `int`  | 是   | -        | 视频画布**宽度**（像素）                                                                         |
| `height`        | `int`  | 是   | -        | 视频画布**高度**（像素）                                                                         |
| `allow_replace` | `bool` | 否   | `True` | 是否允许替换同名草稿。为 `True` 时删除旧草稿后重建；为 `False` 时若存在则抛出 `DraftExistsError` |

**返回值**：`ScriptFile` 实例，代表新创建的草稿文件对象

**常用分辨率组合**：

| 分辨率名称 | width | height | 宽高比 | 典型应用场景           |
| :--------- | :---- | :----- | :----- | :--------------------- |
| 竖屏 1080P | 1080  | 1920   | 9:16   | 抖音、快手等短视频平台 |
| 横屏 1080P | 1920  | 1080   | 16:9   | B站、YouTube 标准视频  |
| 方形 1080P | 1080  | 1080   | 1:1    | Instagram、朋友圈      |
| 竖屏 720P  | 720   | 1280   | 9:16   | 低带宽场景预览         |
| 4K 超高清  | 3840  | 2160   | 16:9   | 专业制作、大屏展示     |

**链式调用特性**：返回的 `ScriptFile` 实例支持方法链式调用，可立即连续执行 `add_track`、`add_segment` 等操作，形成流畅的代码表达式。

##### `duplicate_as_template(template_name, new_name)`

基于现有草稿创建模板副本，实现**模板化批量生产**工作流。

| 参数              | 类型    | 必填 | 说明                           |
| :---------------- | :------ | :--- | :----------------------------- |
| `template_name` | `str` | 是   | 源模板草稿的名称（即文件夹名） |
| `new_name`      | `str` | 是   | 新草稿的名称                   |

**返回值**：`ScriptFile` 实例

**模板工作流详解**：该方法完整复制源草稿的**轨道结构**、**片段布局**、**效果配置**、**文本样式**等所有编辑信息，但**不复制素材文件本身**，新草稿中的片段仍引用原始素材路径。这一设计使得用户可以预先在剪映 GUI 中设计复杂的视觉模板（含转场、动画、特效、字幕样式等），然后通过 Python 脚本批量替换其中的素材和文本内容，快速生成风格统一的系列视频。典型应用场景包括：电商产品展示视频、新闻资讯片头、课程章节包装、社交媒体日签等。

**版本兼容性限制**：模板模式功能目前**仅支持剪映 5.9 及以下版本**。从剪映 6.0 开始，`draft_content.json` 文件采用了加密存储，本库暂时无法读取和修改加密后的模板文件。使用模板功能前请确认剪映版本，或在安装时选择兼容版本。

##### `has_draft(name)`

检查指定名称的草稿是否已存在。

| 参数     | 类型    | 必填 | 说明             |
| :------- | :------ | :--- | :--------------- |
| `name` | `str` | 是   | 待检查的草稿名称 |

**返回值**：`bool`，存在返回 `True`，否则返回 `False`

##### `remove_draft(name)`

**永久删除**指定名称的草稿及其所有内容。

| 参数     | 类型    | 必填 | 说明             |
| :------- | :------ | :--- | :--------------- |
| `name` | `str` | 是   | 待删除的草稿名称 |

**返回值**：`None`

**⚠️ 警告**：此操作**不可逆**，将删除草稿文件夹及其中的所有文件（包括 `draft_content.json`、`draft_meta_info.json` 以及可能关联的缓存文件）。建议在执行前通过 `has_draft` 确认，或做好备份。

##### `list_drafts()`

列出草稿文件夹中的所有草稿项目。

**返回值**：`List[str]`，草稿名称列表（按文件夹名字母顺序）

---

### 1.2 ScriptFile 类

`ScriptFile` 是 pyJianYingDraft 库的**核心操作类**，代表一个完整的剪映草稿项目。它封装了剪映草稿的完整数据结构，包括轨道系统、片段序列、素材引用、特效配置和导出设置，提供了从构建到持久化的全生命周期管理。

#### 1.2.1 轨道管理

##### `add_track(track_type, name="", relative_index=0)`

向草稿中添加指定类型的轨道。剪映采用**多层轨道架构**，不同类型的媒体内容分离到专门轨道，便于独立编辑和效果控制。

| 参数               | 类型          | 必填 | 默认值 | 说明                                                                   |
| :----------------- | :------------ | :--- | :----- | :--------------------------------------------------------------------- |
| `track_type`     | `TrackType` | 是   | -      | 轨道类型，使用 `TrackType` 枚举指定                                  |
| `name`           | `str`       | 否   | `""` | 轨道标识名称，用于后续片段添加时精确指定目标轨道                       |
| `relative_index` | `int`       | 否   | `0`  | **相对层级索引**，值越大表示轨道越靠上层（视频轨道上层覆盖下层） |

**返回值**：`ScriptFile` 实例（支持链式调用）

**轨道层级与覆盖规则**：

| 轨道类型      | 层级特性                 | 典型配置                                                |
| :------------ | :----------------------- | :------------------------------------------------------ |
| 视频轨道      | 上层覆盖下层，透明度混合 | `relative_index=0` 背景层，`1` 内容层，`2` 前景层 |
| 音频轨道      | 并行混合，音量控制平衡   | 多个轨道同时播放，自动混音输出                          |
| 文本轨道      | 始终位于视频轨道之上     | 字幕、标题、动态文字                                    |
| 特效/滤镜轨道 | 作用于下方可见内容       | 全局调色、局部特效应用                                  |

**最佳实践**：建议为轨道设置**有意义的名称**（如 `"主视频"`、`"画中画"`、`"背景音乐"`、`"字幕"`），在复杂项目中便于管理和调试。`relative_index` 的合理规划可以避免频繁的层级调整，推荐按照"背景→主体→装饰→文字"的顺序递增设置。

#### 1.2.2 片段管理

##### `add_segment(segment, track_name=None)`

将媒体片段添加到草稿的指定轨道中，是构建时间轴的**核心操作**。

| 参数           | 类型                 | 必填 | 默认值   | 说明                                                                                                           |
| :------------- | :------------------- | :--- | :------- | :------------------------------------------------------------------------------------------------------------- |
| `segment`    | `Segment` 子类实例 | 是   | -        | 待添加的片段，可以是 `AudioSegment`、`VideoSegment`、`TextSegment`、`EffectSegment`、`FilterSegment` |
| `track_name` | `str`              | 否   | `None` | 目标轨道名称，为 `None` 时按片段类型自动匹配默认轨道                                                         |

**返回值**：`ScriptFile` 实例（支持链式调用）

**自动轨道匹配规则**：

| 片段类型                              | 默认目标轨道                         | 匹配优先级                            |
| :------------------------------------ | :----------------------------------- | :------------------------------------ |
| `AudioSegment`                      | 首个音频轨道（`TrackType.audio`）  | 按名称查找 `"audio"` 或首个音频轨道 |
| `VideoSegment` / `StickerSegment` | 首个视频轨道（`TrackType.video`）  | 按 `relative_index=0` 查找          |
| `TextSegment`                       | 首个文本轨道（`TrackType.text`）   | 按名称查找 `"text"` 或首个文本轨道  |
| `EffectSegment`                     | 首个特效轨道（`TrackType.effect`） | 需显式创建特效轨道                    |
| `FilterSegment`                     | 首个滤镜轨道（`TrackType.filter`） | 需显式创建滤镜轨道                    |

**⚠️ 重要提示**：生产环境中建议**显式指定 `track_name`**，避免自动匹配的意外行为。当目标轨道不存在或类型不匹配时，将抛出 `TrackNotFoundError` 或 `TrackTypeMismatchError`。

##### `add_material(material)`

向草稿的**素材库**中注册素材引用。剪映草稿采用"素材-片段"分离架构，同一素材可被多个片段复用。

| 参数         | 类型                                   | 必填 | 说明     |
| :----------- | :------------------------------------- | :--- | :------- |
| `material` | `VideoMaterial` \| `AudioMaterial` | 是   | 素材实例 |

**返回值**：`ScriptFile` 实例（支持链式调用）

**素材复用优势**：显式注册素材可避免重复的文件元数据读取，提升批量处理效率。当同一视频或音频被多次使用时（如循环播放、分片段引用），先 `add_material` 再创建多个引用片段是推荐模式。

#### 1.2.3 持久化

##### `save()`

将草稿的完整状态保存到磁盘，生成剪映可识别的文件结构。

**返回值**：`None`

**序列化流程**：`save()` 方法执行以下原子性操作：验证草稿结构完整性（检查必需的轨道和片段）；将所有片段对象转换为剪映 JSON 格式（含素材引用、时间映射、变换矩阵、效果参数）；生成轨道布局信息和层级关系；写入素材库索引和元数据；将 `draft_content.json` 写入草稿目录，并更新 `draft_meta_info.json` 等辅助文件。任何步骤失败将回滚，避免生成不完整的草稿。

##### `dump(path)`

将草稿导出到**指定路径**，不影响原草稿文件。

| 参数     | 类型    | 必填 | 说明                                |
| :------- | :------ | :--- | :---------------------------------- |
| `path` | `str` | 是   | 目标文件路径，通常以 `.json` 结尾 |

**返回值**：`None`

**应用场景**：草稿备份、版本管理、跨项目复用、网络传输等。

##### `dumps()`

将草稿序列化为 **JSON 字符串**，不写入文件。

**返回值**：`str`

---

## 2. 轨道类型

### 2.1 TrackType 枚举

`TrackType` 枚举定义剪映支持的所有轨道类型，是 `add_track()` 方法的参数来源。

| 枚举成员              | 值            | 功能描述                                       | 可容纳片段类型     |
| :-------------------- | :------------ | :--------------------------------------------- | :----------------- |
| `TrackType.audio`   | `"audio"`   | **音频轨道**，承载所有声音内容           | `AudioSegment`   |
| `TrackType.video`   | `"video"`   | **视频轨道**，承载视觉媒体内容           | `VideoSegment`   |
| `TrackType.text`    | `"text"`    | **文本轨道**，承载字幕和标题             | `TextSegment`    |
| `TrackType.effect`  | `"effect"`  | **特效轨道**，承载独立特效片段           | `EffectSegment`  |
| `TrackType.filter`  | `"filter"`  | **滤镜轨道**，承载独立滤镜片段           | `FilterSegment`  |
| `TrackType.sticker` | `"sticker"` | **贴纸轨道**（语义别名，等同于视频轨道） | `StickerSegment` |

**轨道系统的核心设计原则**：剪映采用经典的分轨式非线性编辑模型，音频、视频、文本三种基础轨道各司其职，又通过统一的时间轴实现精确同步。视频轨道的**层级叠加**特性是实现复杂视觉效果的基础——上层内容覆盖下层，通过透明度、混合模式等属性可创造出丰富的合成效果。音频轨道的**并行混合**特性则支持多音轨的独立控制和平衡调节。文本轨道作为视觉层的最上层，确保文字内容始终可见。特效和滤镜轨道提供了跨片段的全局效果应用能力，是高级调色的重要工具。

---

## 3. 素材类

素材类是剪映草稿中**原始媒体资源的抽象封装**，负责管理文件路径、自动提取元数据（时长、分辨率、采样率等），并建立素材库索引。pyJianYingDraft 支持**便捷构造模式**——在创建片段时直接传入文件路径，库内部自动创建对应的素材实例——但在需要读取素材属性（如动态计算片段时长）时，显式创建素材实例是必要的。

### 3.1 VideoMaterial 类

`VideoMaterial` 封装视频、图片、GIF 等视觉素材的元信息，支持常见格式的自动探测和时长提取。

#### 3.1.1 构造函数

```python
VideoMaterial(path: str)
```

| 参数     | 类型    | 必填 | 说明                                   |
| :------- | :------ | :--- | :------------------------------------- |
| `path` | `str` | 是   | 素材文件的**绝对路径**或相对路径 |

**核心属性**：

| 属性名          | 类型      | 访问权限 | 说明                                                        |
| :-------------- | :-------- | :------- | :---------------------------------------------------------- |
| `path`        | `str`   | 只读     | 素材文件路径                                                |
| `duration`    | `tim`   | 只读     | 素材**总时长**，视频/GIF 自动探测，图片默认为 5 秒    |
| `width`       | `int`   | 只读     | 素材宽度（像素）                                            |
| `height`      | `int`   | 只读     | 素材高度（像素）                                            |
| `fps`         | `float` | 只读     | 视频帧率，图片/GIF 为 `None`                              |
| `material_id` | `str`   | 只读     | 素材**全局唯一标识符**（UUID），自动生成的内部引用 ID |

**支持的文件格式**：

| 类别 | 格式                                                                  |
| :--- | :-------------------------------------------------------------------- |
| 视频 | `.mp4`, `.mov`, `.avi`, `.mkv`, `.flv`, `.wmv`, `.webm` |
| 图片 | `.jpg`, `.jpeg`, `.png`, `.bmp`, `.tiff`, `.webp`         |
| 动画 | `.gif`, `.apng`                                                   |

**时长属性的关键价值**：`duration` 是构建动态时间轴的基础。例如，创建与 GIF 完全等长的贴纸片段、实现视频与音频的精确对齐、计算片段链的自动衔接位置等场景，都需要先获取素材时长。`VideoMaterial` 在构造时通过 ffprobe 等工具自动提取元数据并缓存，避免重复 I/O。

### 3.2 AudioMaterial 类

`AudioMaterial` 封装音频素材的元信息，API 结构与 `VideoMaterial` 保持对称。

#### 3.2.1 构造函数

```python
AudioMaterial(path: str)
```

| 参数     | 类型    | 必填 | 说明                         |
| :------- | :------ | :--- | :--------------------------- |
| `path` | `str` | 是   | 音频文件的绝对路径或相对路径 |

**核心属性**：

| 属性名          | 类型    | 访问权限 | 说明                          |
| :-------------- | :------ | :------- | :---------------------------- |
| `path`        | `str` | 只读     | 素材文件路径                  |
| `duration`    | `tim` | 只读     | 音频**总时长**          |
| `sample_rate` | `int` | 只读     | 采样率（Hz），如 44100、48000 |
| `channels`    | `int` | 只读     | 声道数，1=单声道，2=立体声    |
| `bitrate`     | `int` | 只读     | 比特率（bps）                 |
| `material_id` | `str` | 只读     | 素材全局唯一标识符            |

**支持的文件格式**：`.mp3`, `.wav`, `.flac`, `.aac`, `.ogg`, `.m4a`, `.wma`

---

## 4. 视频片段

### 4.1 VideoSegment 类

`VideoSegment` 是 pyJianYingDraft 中**功能最丰富的类**，代表视频轨道上的一段视觉内容。它封装了素材引用、时间映射、变换效果、动画、转场、特效、滤镜、蒙版等完整的视频编辑能力，采用**流畅接口设计**，几乎所有配置方法都返回 `self` 支持链式调用。

#### 4.1.1 构造函数

`VideoSegment` 支持**两种构造模式**：

**模式一：便捷构造（直接传入路径）**

```python
VideoSegment(
    material: Union[str, VideoMaterial],
    target_timerange: Timerange,
    *,
    source_timerange: Optional[Timerange] = None,
    speed: Optional[float] = None,
    clip_settings: Optional[ClipSettings] = None
)
```

**模式二：显式构造（推荐用于需要读取素材属性的场景）**

```python
material = VideoMaterial("video.mp4")  # 先创建素材
segment = VideoSegment(material, target_timerange, ...)  # 再创建片段
```

| 参数                 | 类型                         | 必填 | 默认值   | 说明                                                        |
| :------------------- | :--------------------------- | :--- | :------- | :---------------------------------------------------------- |
| `material`         | `str` \| `VideoMaterial` | 是   | -        | 素材来源，**字符串路径**或 `VideoMaterial` 实例     |
| `target_timerange` | `Timerange`                | 是   | -        | 片段在轨道上的**目标时间范围**（位置和持续时间）      |
| `source_timerange` | `Timerange`                | 否   | `None` | 从素材中**截取的时间范围**，`None` 表示使用完整素材 |
| `speed`            | `float`                    | 否   | `None` | **播放速度倍率**，`None` 时自动计算                 |
| `clip_settings`    | `ClipSettings`             | 否   | `None` | 初始**变换设置**（位置、缩放、旋转、透明度）          |

**核心属性**：

| 属性名         | 类型              | 说明                                                                |
| :------------- | :---------------- | :------------------------------------------------------------------ |
| `start`      | `tim`           | 片段在轨道上的**开始时间**（只读）                            |
| `end`        | `tim`           | 片段在轨道上的**结束时间**（只读），等于 `start + duration` |
| `duration`   | `tim`           | 片段**目标持续时间**（只读）                                  |
| `material`   | `VideoMaterial` | 引用的素材对象（只读）                                              |
| `segment_id` | `str`           | 片段**全局唯一标识符**（只读）                                |

**时间映射机制详解**：`target_timerange` 和 `source_timerange` 的分离设计实现了**灵活的时间重映射**。三者的关系为：`target_timerange.duration ≈ source_timerange.duration / speed`（允许微小舍入误差）。典型应用场景包括：等速播放（`source_timerange=None`, `speed=None`）、指定素材片段（显式 `source_timerange`）、变速播放（指定 `speed` 自动调整时长）、完全控制（三者均指定，系统验证一致性）。这一机制使得快放、慢放、定格、倒放等效果无需手动计算，极大简化了时间轴构建。

#### 4.1.2 动画效果

##### `add_animation(intro_type, outro_type=None, group_type=None)`

为视频片段添加**入场、出场或组合动画**。

| 参数           | 类型                   | 必填 | 默认值   | 说明                                     |
| :------------- | :--------------------- | :--- | :------- | :--------------------------------------- |
| `intro_type` | `IntroType`          | 条件 | `None` | **入场动画**类型                   |
| `outro_type` | `OutroType`          | 条件 | `None` | **出场动画**类型                   |
| `group_type` | `GroupAnimationType` | 条件 | `None` | **组合动画**类型（同时设置入出场） |

**返回值**：`VideoSegment` 实例（链式调用）

**参数约束**：三个参数至少指定一个。`group_type` 与 `intro_type`/`outro_type` 互斥，同时指定时 `group_type` 优先。

**动画系统架构**：

| 动画类别                          | 触发时机     | 典型效果                                             | 持续时间控制             |
| :-------------------------------- | :----------- | :--------------------------------------------------- | :----------------------- |
| 入场动画 (`IntroType`)          | 片段开始时   | 淡入、滑入、缩放进入、旋转进入、模糊淡入、闪白、闪黑 | 预设固定值或片段时长比例 |
| 出场动画 (`OutroType`)          | 片段结束时   | 淡出、滑出、缩放退出、旋转退出                       | 同上                     |
| 组合动画 (`GroupAnimationType`) | 贯穿片段全程 | 心跳、弹跳、摇摆、抖动                               | 等于片段时长             |

**常用入场动画**：`IntroType.渐显`（经典淡入）、`IntroType.斜切`（动态切割）、`IntroType.放大`/`IntroType.缩小`（缩放冲击）、`IntroType.向左滑动`/`IntroType.向右滑动`/`IntroType.向上滑动`/`IntroType.向下滑动`（方向滑入）、`IntroType.旋转进入`（旋转动感）、`IntroType.模糊淡入`（柔和出现）、`IntroType.闪白`/`IntroType.闪黑`（强烈切换）。

#### 4.1.3 转场效果

##### `add_transition(transition_type, duration=None)`

为视频片段添加**转场效果**，实现与前一片段的平滑过渡。

| 参数                | 类型               | 必填 | 默认值   | 说明                                            |
| :------------------ | :----------------- | :--- | :------- | :---------------------------------------------- |
| `transition_type` | `TransitionType` | 是   | -        | **转场效果类型**                          |
| `duration`        | `tim` \| `str` | 否   | `None` | 转场**持续时间**，`None` 使用类型预设值 |

**返回值**：`VideoSegment` 实例（链式调用）

**⚠️ 关键注意事项：转场添加位置**

> **转场必须添加在"前一个"视频片段上**，而非后一个片段。这是剪映转场机制的核心设计——转场描述的是"如何离开当前片段进入下一片段"，因此属于前一片段的属性。

**转场工作原理**：转场占据前后两个片段的**重叠时间区域**，从前一片段的末尾开始，到后一片段的开头结束。转场期间，两个片段内容按算法规则混合或变换。转场持续时间会影响实际展示时长：两个各 5 秒的片段添加 1 秒转场后，总时长为 9 秒（5 + 5 - 1）。

**常用转场类型**：`TransitionType.淡入淡出`（经典溶解）、`TransitionType.闪白`/`TransitionType.闪黑`（强烈切换）、`TransitionType.叠化`（重叠融合）、`TransitionType.划像`（方向擦除）、`TransitionType.擦除`（线性清除）、`TransitionType.推进`/`TransitionType.拉远`/`TransitionType.拉近`（镜头运动）、`TransitionType.旋转`（旋转换场）、`TransitionType.翻页`（拟物效果）、`TransitionType.立方体`（3D 翻转）、`TransitionType.门`（开合效果）、`TransitionType.百叶窗`（分割 reveal）、`TransitionType.时钟`（扇形展开）、`TransitionType.马赛克`/`TransitionType.像素化`（数字风格）、`TransitionType.模糊`（柔化过渡）、`TransitionType.故障艺术`/`TransitionType.信号故障`/`TransitionType.色差分离`（故障美学）、`TransitionType.波纹`/`TransitionType.水波`（流体效果）、`TransitionType.火焰`/`TransitionType.粒子`（特效风格）。

#### 4.1.4 背景填充

##### `add_background_filling(fill_type, strength=0.0625)`

为视频片段添加**背景填充效果**，处理素材与画布比例不匹配的情况。

| 参数          | 类型      | 必填 | 默认值     | 说明                                                                              |
| :------------ | :-------- | :--- | :--------- | :-------------------------------------------------------------------------------- |
| `fill_type` | `str`   | 是   | -          | **填充类型**：`"blur"`（模糊）、`"color"`（纯色）、`"mirror"`（镜像） |
| `strength`  | `float` | 否   | `0.0625` | **效果强度**，含义因类型而异                                                |

**返回值**：`VideoSegment` 实例（链式调用）

**填充类型详解**：

| 类型         | 效果描述                         | `strength` 含义      | 典型值                                                                   |
| :----------- | :------------------------------- | :--------------------- | :----------------------------------------------------------------------- |
| `"blur"`   | 将素材**模糊放大**作为背景 | 高斯模糊标准差         | `0.0625`（一档）、`0.125`（二档）、`0.25`（三档）、`0.5`（四档） |
| `"color"`  | **纯色填充**背景区域       | 颜色透明度或饱和度调节 | 配合其他参数指定颜色值                                                   |
| `"mirror"` | 将素材**镜像复制**填充背景 | 镜像重复次数或混合强度 | 创意效果场景                                                             |

**应用场景**：竖屏 9:16 素材置于横屏 16:9 画布时，直接缩放会产生黑边或过度裁剪。背景填充通过在素材后方生成扩展内容，**保持原始比例的同时填满画布**，是短视频跨平台适配的常用技术。

#### 4.1.5 视频特效

##### `add_effect(effect_type, params=None, apply_target_type=0)`

为视频片段添加**特效**，支持场景特效和人物特效两大类。

| 参数                  | 类型                                                     | 必填 | 默认值   | 说明                                                        |
| :-------------------- | :------------------------------------------------------- | :--- | :------- | :---------------------------------------------------------- |
| `effect_type`       | `VideoSceneEffectType` \| `VideoCharacterEffectType` | 是   | -        | **特效类型**                                          |
| `params`            | `List[Optional[float]]`                                | 否   | `None` | **特效参数列表**，范围 0-100，`None` 表示使用默认值 |
| `apply_target_type` | `Literal[0, 2]`                                        | 否   | `0`    | **应用目标**：0=片段，2=全局                          |

**返回值**：`VideoSegment` 实例（链式调用）

**特效分类体系**：

| 类别     | 枚举                         | 作用对象               | 典型效果                                                               |
| :------- | :--------------------------- | :--------------------- | :--------------------------------------------------------------------- |
| 场景特效 | `VideoSceneEffectType`     | **整个画面**     | 老电影、复古、黑白、赛博朋克、梦幻、胶片、LOMO、日系、清新、美食、风景 |
| 人物特效 | `VideoCharacterEffectType` | **检测到的人像** | 美颜、瘦脸、大眼、磨皮、美白、口红、腮红、妆容、塑形、趣味贴纸         |

**参数系统**：每个特效定义了可调参数列表，`params` 按顺序提供值。例如老电影特效可能包含 `[颗粒强度, 划痕密度, 闪烁频率, 色调偏移]`，传入 `[70, 30, None, 50]` 表示设置颗粒 70、划痕 30、闪烁默认、色调 50。参数值统一映射到 0-100，便于理解和跨特效比较。

#### 4.1.6 滤镜

##### `add_filter(filter_type, intensity=100.0)`

为视频片段添加**滤镜效果**。

| 参数            | 类型           | 必填 | 默认值    | 说明                          |
| :-------------- | :------------- | :--- | :-------- | :---------------------------- |
| `filter_type` | `FilterType` | 是   | -         | **滤镜类型**            |
| `intensity`   | `float`      | 否   | `100.0` | **滤镜强度**，0.0-100.0 |

**返回值**：`VideoSegment` 实例（链式调用）

**滤镜与特效的核心区别**：

| 特性       | 滤镜（Filter）                             | 特效（Effect）                     |
| :--------- | :----------------------------------------- | :--------------------------------- |
| 处理对象   | 色彩、色调、对比度等**全局调整**     | 特定视觉风格或**像素级处理** |
| 参数复杂度 | 单一强度参数                               | 多参数独立调节                     |
| 性能开销   | 较低，GPU 加速                             | 较高，可能涉及复杂计算             |
| 叠加方式   | 多滤镜**顺序叠加**                   | 通常单特效或特定组合               |
| 典型代表   | 清新、复古、电影感、暖黄、冷蓝、黑白、胶片 | 老电影颗粒、梦幻光晕、故障 glitch  |

**常用滤镜类型**：`FilterType.清新`、`FilterType.复古`、`FilterType.电影`、`FilterType.黑白`、`FilterType.暖黄`、`FilterType.冷蓝`、`FilterType.胶片`、`FilterType.LOMO`、`FilterType.日系`、`FilterType.韩系`、`FilterType.美食`、`FilterType.风景`、`FilterType.人像`、`FilterType.夜景`、`FilterType.甜美`、`FilterType.冷艳`、`FilterType.暖阳`、`FilterType.黄昏`、`FilterType.清晨`、`FilterType.午后`、`FilterType.深夜`。

#### 4.1.7 蒙版

##### `add_mask(mask_type, **kwargs)`

为视频片段添加**蒙版**，实现局部显示或创意遮罩。

| 参数             | 类型         | 必填 | 默认值    | 说明                                                   |
| :--------------- | :----------- | :--- | :-------- | :----------------------------------------------------- |
| `mask_type`    | `MaskType` | 是   | -         | **蒙版形状类型**                                 |
| `center_x`     | `float`    | 否   | `0.0`   | 蒙版中心**X 坐标**，以半素材宽为单位，0 表示居中 |
| `center_y`     | `float`    | 否   | `0.0`   | 蒙版中心**Y 坐标**，以半素材高为单位，0 表示居中 |
| `width`        | `float`    | 否   | `1.0`   | 蒙版**宽度**，以半素材宽为单位                   |
| `height`       | `float`    | 否   | `1.0`   | 蒙版**高度**，以半素材高为单位                   |
| `size`         | `float`    | 条件 | -         | 蒙版**主要尺寸**（圆形/星形等使用）              |
| `rotation`     | `float`    | 否   | `0.0`   | **旋转角度**（度），顺时针为正                   |
| `feather`      | `float`    | 否   | `0.0`   | 边缘**羽化程度**，0.0-1.0                        |
| `invert`       | `bool`     | 否   | `False` | 是否**反转蒙版**（显示区域变隐藏）               |
| `aspect_ratio` | `float`    | 否   | `1.0`   | **宽高比**，特定蒙版类型使用                     |
| `rect_width`   | `float`    | 条件 | -         | 矩形蒙版的**宽度比例**                           |
| `round_corner` | `float`    | 否   | `0.0`   | 矩形蒙版的**圆角半径**，0.0-1.0                  |

**返回值**：`VideoSegment` 实例（链式调用）

**蒙版类型与专属参数**：

| 蒙版类型            | 形状描述     | 关键参数                                | 典型应用              |
| :------------------ | :----------- | :-------------------------------------- | :-------------------- |
| `MaskType.圆形`   | 正圆形       | `size`（直径）                        | 头像展示、聚焦效果    |
| `MaskType.矩形`   | 圆角矩形     | `width`, `height`, `round_corner` | 信息卡片、分屏布局    |
| `MaskType.线性`   | 线性渐变     | 角度和宽度参数                          | 渐变 reveal、扫光效果 |
| `MaskType.镜像`   | 对称镜像     | 对称轴参数                              | 创意对称构图          |
| `MaskType.星形`   | 五角星形     | `size`（外接圆）                      | 装饰元素、节日主题    |
| `MaskType.心形`   | 爱心形状     | `size`（高度）                        | 情感表达、浪漫主题    |
| `MaskType.多边形` | 自定义多边形 | 顶点坐标参数                            | 复杂形状、logo 轮廓   |

**坐标系统详解**：蒙版采用**相对坐标系统**，以素材中心为原点，宽度和高度的一半为单位长度。`center_x=1.0` 表示向右偏移半个素材宽度（到达右边缘），`center_y=-1.0` 表示向上偏移半个素材高度（到达上边缘）。这一设计与素材分辨率解耦，使得蒙版设置具有良好的可移植性，同一蒙版配置可应用于不同分辨率的素材而保持相对位置不变。

### 4.2 StickerSegment 类

`StickerSegment` **继承自 `VideoSegment`**，专门用于 GIF 贴纸片段。它在内部针对 GIF 特性进行了优化：自动识别循环播放、正确处理透明通道、保持原始帧率。由于继承关系，`StickerSegment` 完整获得 `VideoSegment` 的所有方法，包括动画、转场、特效、滤镜、蒙版等。

**实际使用建议**：库内部会根据素材类型自动识别处理，通常直接使用 `VideoSegment` 创建 GIF 片段即可，无需显式区分。当需要明确语义或特殊优化时，可使用 `StickerSegment` 显式构造。

---

## 5. 音频片段

### 5.1 AudioSegment 类

`AudioSegment` 代表音频轨道上的声音片段，提供音量控制、变速变调、淡入淡出、场景音效等完整的音频编辑能力。

#### 5.1.1 构造函数

```python
AudioSegment(
    material: Union[str, AudioMaterial],
    target_timerange: Timerange,
    *,
    source_timerange: Optional[Timerange] = None,
    speed: Optional[float] = None,
    volume: float = 1.0,
    change_pitch: bool = False
)
```

| 参数                 | 类型                         | 必填 | 默认值    | 说明                                          |
| :------------------- | :--------------------------- | :--- | :-------- | :-------------------------------------------- |
| `material`         | `str` \| `AudioMaterial` | 是   | -         | 素材来源，字符串路径或 `AudioMaterial` 实例 |
| `target_timerange` | `Timerange`                | 是   | -         | 轨道上的目标时间范围                          |
| `source_timerange` | `Timerange`                | 否   | `None`  | 素材截取范围                                  |
| `speed`            | `float`                    | 否   | `None`  | 播放速度倍率                                  |
| `volume`           | `float`                    | 否   | `1.0`   | **音量倍数**，1.0=原始音量，0.0=静音    |
| `change_pitch`     | `bool`                     | 否   | `False` | **变速时是否改变音调**                  |

**音量与分贝对照**：

| 音量倍数 | 约等分贝 | 主观听感                   |
| :------- | :------- | :------------------------- |
| 1.0      | 0 dB     | 原始音量                   |
| 0.8      | -2 dB    | 轻微减小                   |
| 0.6      | -4.4 dB  | 明显减小，常用背景音乐音量 |
| 0.5      | -6 dB    | 减半                       |
| 0.25     | -12 dB   | 显著减弱，环境音层次       |
| 0.1      | -20 dB   | 几乎不可闻                 |

**变速变调机制**：

| `speed` | `change_pitch` | 效果                                     | 应用场景             |
| :-------- | :--------------- | :--------------------------------------- | :------------------- |
| 1.0       | 任意             | 正常播放                                 | 标准播放             |
| >1.0      | `False`        | **快放，音调不变**（时间拉伸算法） | 加速讲解、紧凑剪辑   |
| >1.0      | `True`         | 快放，音调变高（Chipmunk 效果）          | 喜剧效果、特殊风格   |
| <1.0      | `False`        | **慢放，音调不变**                 | 慢动作强调、细节展示 |
| <1.0      | `True`         | 慢放，音调变低                           | 低沉氛围、恐怖效果   |

#### 5.1.2 淡入淡出

##### `add_fade(in_duration, out_duration)`

为音频片段添加**淡入淡出效果**。

| 参数             | 类型               | 必填 | 说明                   |
| :--------------- | :----------------- | :--- | :--------------------- |
| `in_duration`  | `tim` \| `str` | 是   | **淡入持续时间** |
| `out_duration` | `tim` \| `str` | 是   | **淡出持续时间** |

**返回值**：`AudioSegment` 实例（链式调用）

**淡变曲线**：剪映默认使用**对数曲线**（logarithmic fade），符合人耳的响度感知特性，听起来比线性变化更加自然。淡入从静音渐变到目标音量，淡出则从目标音量渐变到静音。使用 `"0s"` 可禁用对应方向的淡变。

#### 5.1.3 音频特效

##### `add_effect(effect_type, params=None)`

为音频片段添加**音效处理**。

| 参数            | 类型                                                                   | 必填 | 默认值   | 说明                 |
| :-------------- | :--------------------------------------------------------------------- | :--- | :------- | :------------------- |
| `effect_type` | `AudioSceneEffectType` \| `ToneEffectType` \| `SpeechToSongType` | 是   | -        | 音效类型             |
| `params`      | `List[Optional[float]]`                                              | 否   | `None` | 效果参数，范围 0-100 |

**返回值**：`AudioSegment` 实例（链式调用）

**音频效果分类**：

| 类别     | 枚举                     | 效果描述                                   | 典型应用             |
| :------- | :----------------------- | :----------------------------------------- | :------------------- |
| 场景音效 | `AudioSceneEffectType` | 混响、延迟、合唱、均衡、压缩、降噪         | 空间感塑造、音质优化 |
| 音色调整 | `ToneEffectType`       | 电话音、收音机音、机器人音、怪兽音、水下音 | 风格化处理、角色塑造 |
| 歌声合成 | `SpeechToSongType`     | 将**语音转换为歌唱**（AI 驱动）      | 创意内容、鬼畜视频   |

---

## 6. 文本片段

### 6.1 TextSegment 类

`TextSegment` 是 pyJianYingDraft 中**最复杂的片段类型**，整合字体选择、样式设置、位置变换、动画效果、装饰元素（气泡、花字）等多个维度的控制能力，是制作专业字幕和动态标题的核心工具。

#### 6.1.1 构造函数

```python
TextSegment(
    text: str,
    target_timerange: Timerange,
    *,
    font: FontType = None,
    style: TextStyle = None,
    clip_settings: ClipSettings = None,
    max_width: Optional[int] = None
)
```

| 参数                 | 类型             | 必填 | 默认值   | 说明                                     |
| :------------------- | :--------------- | :--- | :------- | :--------------------------------------- |
| `text`             | `str`          | 是   | -        | **文本内容**，支持 `\n` 换行     |
| `target_timerange` | `Timerange`    | 是   | -        | 显示时间范围                             |
| `font`             | `FontType`     | 否   | `None` | **字体类型**                       |
| `style`            | `TextStyle`    | 否   | `None` | **文本样式**（颜色、大小、粗细等） |
| `clip_settings`    | `ClipSettings` | 否   | `None` | **变换设置**（位置、缩放、旋转等） |
| `max_width`        | `int`          | 否   | `None` | **最大行宽**（像素），超出自动换行 |

**自动换行机制**：`max_width` 启用智能换行，按字符边界和标点规则分割长文本。换行后行高由 `style.line_spacing` 控制，总高度自动扩展。这一功能特别适用于字幕批量生成，确保不同长度文本的视觉一致性。

**坐标定位实践**：`ClipSettings.transform_y=-0.8` 将文本放置在屏幕垂直方向 80% 偏下位置，即底部区域，是字幕的标准位置。配合 `TextStyle.align="center"` 实现水平居中，形成经典字幕布局。

#### 6.1.2 动画效果

##### `add_animation(animation_type, duration=None)`

为文本片段添加**动画效果**。

| 参数               | 类型                                           | 必填 | 默认值   | 说明         |
| :----------------- | :--------------------------------------------- | :--- | :------- | :----------- |
| `animation_type` | `TextIntro` \| `TextOutro` \| `TextLoop` | 是   | -        | 动画类型     |
| `duration`       | `tim`                                        | 否   | `None` | 动画持续时间 |

**返回值**：`TextSegment` 实例（链式调用）

**文本动画特性**：与视频动画不同，文本动画支持**字符级控制**，可实现逐字出现、逐行飞入等精细效果。`duration` 对于逐字动画控制单个字符的动画时长，总动画时长为 `duration × 字符数`。

#### 6.1.3 气泡效果

##### `add_bubble(bubble_id, sticker_id)`

为文本添加**气泡背景装饰**。

| 参数           | 类型    | 必填 | 说明                  |
| :------------- | :------ | :--- | :-------------------- |
| `bubble_id`  | `str` | 是   | **气泡样式 ID** |
| `sticker_id` | `str` | 是   | **关联贴纸 ID** |

**返回值**：`TextSegment` 实例（链式调用）

**素材 ID 获取**：`bubble_id` 和 `sticker_id` 是剪映内部使用的素材标识符，需要通过**模板提取**方式获取：在剪映 GUI 中创建包含目标气泡的草稿，使用 `duplicate_as_template` 复制后分析 `draft_content.json` 中的素材引用；或使用库提供的辅助工具查询剪映素材库。

#### 6.1.4 花字效果

##### `add_effect(effect_id)`

为文本添加**花字特效**，应用预设的艺术字样式。

| 参数          | 类型    | 必填 | 说明                  |
| :------------ | :------ | :--- | :-------------------- |
| `effect_id` | `str` | 是   | **花字效果 ID** |

**返回值**：`TextSegment` 实例（链式调用）

**花字与样式的关系**：花字是**预定义的完整艺术字样式**，包含颜色、描边、阴影、纹理、动画等多层设计。应用花字时，`TextStyle` 中的基础颜色可能被覆盖，但位置、大小等几何属性仍然有效。

### 6.2 样式类

#### 6.2.1 TextStyle 类

```python
TextStyle(
    color: Tuple[float, float, float] = (1.0, 1.0, 1.0),
    font_size: float = 8.0,
    bold: bool = False,
    italic: bool = False,
    underline: bool = False,
    line_spacing: float = 1.0,
    letter_spacing: float = 0.0,
    align: str = "center"
)
```

| 参数               | 类型                           | 默认值              | 说明                                                      |
| :----------------- | :----------------------------- | :------------------ | :-------------------------------------------------------- |
| `color`          | `Tuple[float, float, float]` | `(1.0, 1.0, 1.0)` | **RGB 颜色**，各分量 0.0-1.0，默认白色              |
| `font_size`      | `float`                      | `8.0`             | 字体大小，剪映内部单位                                    |
| `bold`           | `bool`                       | `False`           | 是否**粗体**                                        |
| `italic`         | `bool`                       | `False`           | 是否**斜体**                                        |
| `underline`      | `bool`                       | `False`           | 是否**下划线**                                      |
| `line_spacing`   | `float`                      | `1.0`             | **行间距倍数**，1.0=单倍                            |
| `letter_spacing` | `float`                      | `0.0`             | **字间距调整**，正数增大，负数减小                  |
| `align`          | `str`                        | `"center"`        | **水平对齐**：`"left"`、`"center"`、`"right"` |

**颜色表示**：`(1.0, 1.0, 0.0)` = 黄色，`(1.0, 0.0, 0.0)` = 红色，`(0.0, 1.0, 0.0)` = 绿色，`(0.0, 0.0, 1.0)` = 蓝色，`(0.0, 0.0, 0.0)` = 黑色，`(1.0, 1.0, 1.0)` = 白色。

#### 6.2.2 TextBorder 类（描边）

```python
TextBorder(
    width: float = 0.0,
    color: Tuple[float, float, float] = (0.0, 0.0, 0.0),
    alpha: float = 1.0
)
```

| 参数      | 类型                           | 默认值              | 说明                         |
| :-------- | :----------------------------- | :------------------ | :--------------------------- |
| `width` | `float`                      | `0.0`             | **描边宽度**，0=无描边 |
| `color` | `Tuple[float, float, float]` | `(0.0, 0.0, 0.0)` | 描边颜色，默认黑色           |
| `alpha` | `float`                      | `1.0`             | 描边**不透明度**       |

#### 6.2.3 TextBackground 类（背景）

```python
TextBackground(
    color: Tuple[float, float, float] = (0.0, 0.0, 0.0),
    alpha: float = 0.5,
    round_radius: float = 0.0
)
```

| 参数             | 类型                           | 默认值              | 说明                       |
| :--------------- | :----------------------------- | :------------------ | :------------------------- |
| `color`        | `Tuple[float, float, float]` | `(0.0, 0.0, 0.0)` | 背景颜色，默认黑色         |
| `alpha`        | `float`                      | `0.5`             | 背景**不透明度**     |
| `round_radius` | `float`                      | `0.0`             | **圆角半径**，0=直角 |

#### 6.2.4 TextShadow 类（阴影）

```python
TextShadow(
    color: Tuple[float, float, float] = (0.0, 0.0, 0.0),
    alpha: float = 0.5,
    distance: float = 5.0,
    angle: float = 135.0,
    size: float = 5.0
)
```

| 参数         | 类型                           | 默认值              | 说明                                                         |
| :----------- | :----------------------------- | :------------------ | :----------------------------------------------------------- |
| `color`    | `Tuple[float, float, float]` | `(0.0, 0.0, 0.0)` | 阴影颜色，默认黑色                                           |
| `alpha`    | `float`                      | `0.5`             | 阴影**不透明度**                                       |
| `distance` | `float`                      | `5.0`             | 阴影**偏移距离**（像素）                               |
| `angle`    | `float`                      | `135.0`           | 阴影**偏移角度**（度），0=右方，逆时针增加，135=左上方 |
| `size`     | `float`                      | `5.0`             | 阴影**模糊半径**（像素）                               |

### 6.3 ClipSettings 类

`ClipSettings` 是**通用的变换设置类**，用于控制片段在画布上的位置、缩放、旋转和透明度。

```python
ClipSettings(
    transform_x: float = 0.0,   # 水平位置，-1.0~1.0，0=居中，负=左，正=右
    transform_y: float = 0.0,   # 垂直位置，-1.0~1.0，0=居中，负=上，正=下
    scale: float = 1.0,          # 缩放倍数，1.0=原始大小
    rotation: float = 0.0,       # 旋转角度（度），顺时针为正
    alpha: float = 1.0           # 不透明度，0.0=透明，1.0=不透明
)
```

**变换组合顺序**：剪映应用变换的顺序为 **缩放 → 旋转 → 位移 → 透明度**。这一标准顺序确保旋转不会导致意外的位置偏移，是计算机图形学的通用做法。

---

## 7. 特效与滤镜

### 7.1 EffectSegment 类

`EffectSegment` 用于创建**独立的特效片段**，与附加在视频片段上的特效不同，独立特效可以作用于整个画面或特定时间范围，实现跨片段的全局效果控制。

典型应用场景：在整个视频段落上应用统一的调色特效，或在特定时间段叠加全局视觉效果。独立特效通过时间范围精确定位，不影响单个片段的其他属性。

### 7.2 FilterSegment 类

`FilterSegment` 用于创建**独立的滤镜片段**，功能与 `EffectSegment` 类似但专注于色彩调整。独立滤镜支持动态的色彩变化，如模拟时间流逝的色温渐变，或不同场景间的风格切换。

### 7.3 特效类型枚举

#### 7.3.1 视频场景特效（VideoSceneEffectType）

作用于**整个画面**的像素级处理效果，营造特定视觉风格或氛围。

| 效果类别 | 典型枚举值                               | 视觉特征                   |
| :------- | :--------------------------------------- | :------------------------- |
| 复古风格 | `老电影`, `复古`, `胶片`, `LOMO` | 颗粒、划痕、色调偏移、暗角 |
| 色调风格 | `日系`, `清新`, `暖黄`, `冷蓝`   | 色温、饱和度、对比度调整   |
| 创意风格 | `赛博朋克`, `梦幻`, `黑白`         | 高对比、霓虹、柔光、去色   |
| 场景优化 | `美食`, `风景`, `人像`, `夜景`   | 针对特定内容的优化预设     |

#### 7.3.2 视频人物特效（VideoCharacterEffectType）

针对**检测到的人像区域**进行增强或变形处理。

| 效果类别 | 典型枚举值                   | 技术特点               |
| :------- | :--------------------------- | :--------------------- |
| 基础美颜 | `美颜`, `磨皮`, `美白` | 肤质平滑、亮度提升     |
| 面部塑形 | `瘦脸`, `大眼`, `瘦鼻` | 基于关键点的几何变形   |
| 妆容效果 | `口红`, `腮红`, `妆容` | 虚拟化妆、色彩叠加     |
| 趣味效果 | 动态贴纸、表情复制           | 人脸识别驱动的 AR 效果 |

#### 7.3.3 音频场景特效（AudioSceneEffectType）

模拟声学环境或添加音乐性处理的**空间和时间效果**。

| 效果类别 | 典型效果                     | 功能描述               |
| :------- | :--------------------------- | :--------------------- |
| 空间效果 | 房间混响、大厅混响、教堂混响 | 模拟不同空间的声学特性 |
| 调制效果 | 合唱、镶边、相位、颤音       | 通过延迟和调制丰富音色 |
| 动态效果 | 压缩、限制器、噪声门         | 控制音频动态范围       |
| 均衡效果 | 低音增强、高音增强、电话音   | 调整频谱平衡           |

#### 7.3.4 音色特效（ToneEffectType）

改变声音**质感特征**的风格化处理。

| 枚举值       | 效果描述               | 典型应用           |
| :----------- | :--------------------- | :----------------- |
| `电话音`   | 限制频宽、添加噪声     | 模拟通话场景       |
| `收音机音` | 中频突出、添加调制噪声 | 复古广播风格       |
| `机器人音` | 金属共振、音调量化     | 科幻、电子风格     |
| `怪兽音`   | 降低音调、添加失真     | 恐怖、游戏内容     |
| `水下音`   | 低通滤波、添加气泡声   | 特殊场景、创意表达 |

#### 7.3.5 歌声合成（SpeechToSongType）

剪映的**AI 特色功能**，将普通语音转换为歌唱效果。

| 枚举值   | 曲风特征             |
| :------- | :------------------- |
| `流行` | 标准流行歌曲旋律     |
| `民谣` | 抒情、叙事性旋律     |
| `摇滚` | 强劲节奏、高能量     |
| `电子` | 合成器音色、律动导向 |

**使用注意**：歌声合成需要清晰的语音输入，背景噪声和混响会影响合成质量。合成后的音频可进一步添加混响、延迟等效果增强音乐感。

---

## 8. 转场与动画

### 8.1 TransitionType 枚举

`TransitionType` 枚举定义剪映支持的**所有视频转场效果**，按照视觉特征分类如下：

| 类别     | 典型枚举值                                         | 视觉特征           | 适用节奏           |
| :------- | :------------------------------------------------- | :----------------- | :----------------- |
| 基础过渡 | `淡入淡出`, `叠化`, `划像`, `擦除`         | 简洁、不抢内容风头 | 通用、叙事性内容   |
| 动态模糊 | `模糊`, `模糊溶解`, `运动模糊切换`           | 速度感、流畅性     | 快节奏、运动内容   |
| 几何变换 | `旋转`, `翻转`, `立方体`, `翻页`           | 强烈的空间动感     | 创意转场、章节切换 |
| 特效风格 | `故障艺术`, `信号故障`, `像素化`, `马赛克` | 数字美学、风格化   | 科技、潮流内容     |
| 模拟物理 | `门`, `百叶窗`, `时钟`, `波纹`, `水波`   | 拟物设计、真实感   | 优雅、精致内容     |
| 强烈切换 | `闪白`, `闪黑`, `推进`, `拉远`, `拉近`   | 冲击力、明确分隔   | 高潮、重点强调     |

### 8.2 IntroType 枚举

**视频入场动画**类型，控制片段开始时的视觉出现方式。

| 枚举值                                              | 动画特征                    |
| :-------------------------------------------------- | :-------------------------- |
| `渐显`                                            | 透明度从 0 到 1，最柔和自然 |
| `斜切`                                            | 对角线切割 reveal，动态感强 |
| `放大`                                            | 从小到大的缩放冲击          |
| `缩小`                                            | 从大到小的聚焦效果          |
| `向左滑动`/`向右滑动`/`向上滑动`/`向下滑动` | 方向明确的平移进入          |
| `旋转进入`                                        | 伴随旋转的活力动感          |
| `模糊淡入`                                        | 从模糊到清晰的柔和出现      |
| `闪白`/`闪黑`                                   | 强烈的光效切换              |

### 8.3 TextIntro 枚举

**文本入场动画**类型，支持字符级精细控制。

| 枚举值       | 动画特征                   |
| :----------- | :------------------------- |
| `打字机`   | 逐字符出现，经典字幕效果   |
| `逐字飞入` | 每个字符独立飞入，活泼动感 |
| `淡入`     | 整体透明度渐变             |
| `滑入`     | 从边缘平移进入             |
| `弹跳进入` | 弹性动画，趣味性强         |

### 8.4 TextOutro 枚举

**文本出场动画**类型。

| 枚举值       | 动画特征                       |
| :----------- | :----------------------------- |
| `故障闪动` | 模拟数字信号干扰的 glitch 效果 |
| `逐字消失` | 字符逐个淡出或飞出             |
| `整体淡出` | 透明度渐变到 0                 |
| `滑出`     | 向边缘平移离开                 |

### 8.5 TextLoop 枚举

**文本循环动画**类型，持续播放的效果。

| 枚举值   | 动画特征         |
| :------- | :--------------- |
| `闪烁` | 透明度周期性变化 |
| `呼吸` | 缩放周期性变化   |
| `波浪` | 字符上下波动     |
| `跳动` | 弹性上下跳动     |

---

## 9. 字体与蒙版

### 9.1 FontType 枚举

`FontType` 枚举定义剪映预设的**中文字体库**，涵盖多种风格场景。

| 枚举值             | 风格特征         | 适用场景       |
| :----------------- | :--------------- | :------------- |
| `默认字体`       | 系统默认无衬线体 | 通用场景       |
| `文轩体`         | 优雅、文化感     | 标题、引言     |
| `站酷快乐体`     | 活泼、趣味       | 娱乐、儿童内容 |
| `站酷高端黑`     | 现代、力量感     | 科技、运动内容 |
| `思源黑体`       | 专业、清晰       | 正文、字幕     |
| `思源宋体`       | 传统、正式       | 书籍、文化内容 |
| `阿里巴巴普惠体` | 商业、现代       | 电商、品牌内容 |
| `优设标题黑`     | 醒目、冲击力     | 大标题、海报   |

### 9.2 MaskType 枚举

`MaskType` 枚举定义剪映支持的**蒙版形状类型**。

| 枚举值     | 形状描述     | 关键参数                                |
| :--------- | :----------- | :-------------------------------------- |
| `圆形`   | 正圆形       | `size`（直径）                        |
| `矩形`   | 圆角矩形     | `width`, `height`, `round_corner` |
| `线性`   | 线性渐变遮罩 | 角度、宽度参数                          |
| `镜像`   | 对称镜像形状 | 对称轴参数                              |
| `星形`   | 五角星形     | `size`（外接圆直径）                  |
| `心形`   | 爱心形状     | `size`（高度）                        |
| `多边形` | 自定义多边形 | 顶点坐标数组                            |

---

## 10. 时间工具

### 10.1 时间表示

#### 10.1.1 tim 类

`tim` 类表示**时间点或时间长度**，内部以**微秒**（microsecond, 10⁻⁶ 秒）为单位存储，提供与多种时间格式的便捷转换。

**构造方式**：

| 构造形式   | 示例                 | 等效微秒值 |
| :--------- | :------------------- | :--------- |
| 秒字符串   | `tim("1.5s")`      | 1,500,000  |
| 毫秒字符串 | `tim("500ms")`     | 500,000    |
| 微秒字符串 | `tim("1000000us")` | 1,000,000  |
| 整数微秒   | `tim(1500000)`     | 1,500,000  |

**常用时间常量**（模块级别）：

| 常量    | 值        | 说明           |
| :------ | :-------- | :------------- |
| `SEC` | 1,000,000 | 1 秒的微秒值   |
| `MS`  | 1,000     | 1 毫秒的微秒值 |

#### 10.1.2 Timerange 类

`Timerange` 表示**时间范围**，由起始时间和持续时间组成，是定义片段位置的核心数据结构。

**构造方式**：

| 方式     | 示例                                | 说明                   |
| :------- | :---------------------------------- | :--------------------- |
| 便捷函数 | `trange("0s", "5s")`              | 从 0 秒开始，持续 5 秒 |
| 便捷函数 | `trange(start_tim, duration_tim)` | 使用 `tim` 对象      |
| 属性访问 | `video_segment.target_timerange`  | 获取已有片段的时间范围 |

**关键理解**：`trange` 的**第二个参数是持续时间，而非结束时间**。`trange("0s", "5s")` 表示从 0 秒开始、持续 5 秒的片段，结束时间为 5 秒。这一设计使得时间计算更加直观，避免了频繁的加减运算。

### 10.2 便捷函数

#### 10.2.1 `trange(start, duration)` 函数

创建 `Timerange` 实例的**便捷函数**，自动处理字符串到 `tim` 对象的转换。

| 参数         | 类型               | 说明                             |
| :----------- | :----------------- | :------------------------------- |
| `start`    | `tim` \| `str` | 起始时间                         |
| `duration` | `tim` \| `str` | **持续时间**（非结束时间） |

**返回值**：`Timerange` 实例

**典型使用模式**：

```python
# 绝对时间定位
trange("0s", "5s")           # 片头 5 秒
trange("10s", "3s")          # 从 10 秒开始，持续 3 秒

# 相对时间定位（链式编辑的核心）
trange(video_segment.end, "5s")                    # 接上一片段结尾
trange(audio_segment.end, gif_material.duration)   # 动态计算时长
trange(0, tim("2s") + tim("500ms"))                # 时间运算
```

#### 10.2.2 时间运算

`tim` 对象支持**加减运算**，便于动态计算：

```python
from pyJianYingDraft import tim, trange, SEC

# 时间加减
start = tim("5s")
duration = tim("3s")
end = start + duration        # 8 秒

# 与整数运算（微秒为单位）
half_second = SEC // 2        # 500000 微秒

# 用于动态片段定位
seg1 = VideoSegment("a.mp4", trange("0s", "5s"))
seg2 = VideoSegment("b.mp4", trange(seg1.end, "3s"))  # 无缝衔接
```

---

## 11. 剪映控制（Windows）

### 11.1 JianyingController 类

`JianyingController` 提供**Windows 平台上的剪映应用自动化控制**，实现草稿的自动导出，无需人工操作 GUI。

#### 11.1.1 构造函数

```python
JianyingController()
```

**平台限制**：**仅 Windows 可用**，依赖 Windows UI 自动化技术。

**前提条件**：剪映专业版必须已安装，且能够通过桌面快捷方式或开始菜单启动。

#### 11.1.2 导出草稿

##### `export_draft(draft_name, output_path, resolution=None, framerate=None, bitrate=None)`

**自动导出指定草稿为视频文件**。

| 参数            | 类型                 | 必填 | 默认值   | 说明                                            |
| :-------------- | :------------------- | :--- | :------- | :---------------------------------------------- |
| `draft_name`  | `str`              | 是   | -        | 要导出的草稿名称                                |
| `output_path` | `str`              | 是   | -        | 输出视频文件的**完整路径**（含扩展名）    |
| `resolution`  | `ExportResolution` | 否   | `None` | 输出**分辨率**，`None` 使用草稿设置     |
| `framerate`   | `ExportFramerate`  | 否   | `None` | 输出**帧率**，`None` 使用草稿设置       |
| `bitrate`     | `int`              | 否   | `None` | 输出**比特率**（kbps），`None` 使用默认 |

**返回值**：`None`

**自动化流程**：该方法执行以下步骤：启动剪映应用（若未运行）；导航到草稿列表，定位指定草稿；打开草稿，进入导出界面；设置分辨率、帧率、比特率等参数；开始导出并监控进度；导出完成后关闭或保持应用状态。整个过程无需人工干预，适用于批量视频生产流水线。

**⚠️ 稳定性注意**：UI 自动化依赖界面元素的定位和操作，剪映版本更新可能导致界面变化，进而影响自动化稳定性。建议在生产环境中锁定剪映版本，或定期验证自动化脚本。

### 11.2 导出配置枚举

#### 11.2.1 ExportResolution

| 枚举值                         | 分辨率     | 适用场景           |
| :----------------------------- | :--------- | :----------------- |
| `ExportResolution.RES_720P`  | 1280×720  | 快速预览、网络传播 |
| `ExportResolution.RES_1080P` | 1920×1080 | 标准高清，最常用   |
| `ExportResolution.RES_4K`    | 3840×2160 | 超高清、专业制作   |

#### 11.2.2 ExportFramerate

| 枚举值                    | 帧率   | 适用场景           |
| :------------------------ | :----- | :----------------- |
| `ExportFramerate.FR_24` | 24 fps | 电影感、叙事内容   |
| `ExportFramerate.FR_30` | 30 fps | 标准视频、网络内容 |
| `ExportFramerate.FR_60` | 60 fps | 流畅运动、游戏内容 |

---

## 12. 模板模式

模板模式是 pyJianYingDraft 的**高级功能**，支持基于现有草稿的批量内容生成。通过 `DraftFolder.duplicate_as_template()` 方法，可以完整复制模板草稿的结构，仅替换素材和文本内容，实现风格统一的规模化生产。

### 12.1 ShrinkMode 枚举

当**素材长度不足**时的处理模式。

| 枚举值                  | 行为描述                   |
| :---------------------- | :------------------------- |
| `ShrinkMode.ERROR`    | 抛出异常，终止处理（默认） |
| `ShrinkMode.LOOP`     | 循环播放素材直至满足时长   |
| `ShrinkMode.FREEZE`   | 素材最后一帧定格至满足时长 |
| `ShrinkMode.TRUNCATE` | 截断片段时长至素材实际长度 |

### 12.2 ExtendMode 枚举

当**素材长度超出**时的处理模式。

| 枚举值                  | 行为描述                   |
| :---------------------- | :------------------------- |
| `ExtendMode.ERROR`    | 抛出异常，终止处理（默认） |
| `ExtendMode.TRUNCATE` | 截断素材至目标时长         |
| `ExtendMode.SPEED_UP` | 自动加速播放以匹配时长     |

---

## 附录：完整工作流示例

```python
import os
import pyJianYingDraft as draft
from pyJianYingDraft import (
    IntroType, TransitionType, TextOutro, 
    trange, tim, FontType, TextStyle, ClipSettings
)

# ========== 1. 初始化 ==========
draft_folder = draft.DraftFolder(r"C:\Users\Name\JianyingPro Drafts")

# ========== 2. 创建草稿 ==========
script = draft_folder.create_draft("demo_project", 1920, 1080, allow_replace=True)

# ========== 3. 添加轨道 ==========
script.add_track(draft.TrackType.audio, "bgm", 0) \
      .add_track(draft.TrackType.video, "main", 0) \
      .add_track(draft.TrackType.video, "overlay", 1) \
      .add_track(draft.TrackType.text, "subtitle", 0)

# ========== 4. 音频片段 ==========
audio_seg = draft.AudioSegment(
    "background_music.mp3",
    trange("0s", "60s"),
    volume=0.6
)
audio_seg.add_fade("2s", "3s")  # 2秒淡入，3秒淡出

# ========== 5. 视频片段 ==========
# 主视频
main_video = draft.VideoSegment(
    "main_content.mp4",
    trange("0s", "30s"),
    clip_settings=ClipSettings(scale=1.0)
)
main_video.add_animation(IntroType.斜切)

# GIF 贴纸（动态时长）
gif_mat = draft.VideoMaterial("animated_sticker.gif")
sticker = draft.VideoSegment(
    gif_mat,
    trange(main_video.end, gif_mat.duration)  # 紧跟主视频
)
sticker.add_background_filling("blur", 0.0625)

# 转场（加在前一片段）
main_video.add_transition(TransitionType.信号故障, duration="0.5s")

# ========== 6. 文本片段 ==========
subtitle = draft.TextSegment(
    "pyJianYingDraft 让视频生产自动化",
    main_video.target_timerange,  # 与主视频同步
    font=FontType.文轩体,
    style=TextStyle(
        color=(1.0, 1.0, 0.0),  # 黄色
        font_size=10.0,
        bold=True
    ),
    clip_settings=ClipSettings(transform_y=-0.8)  # 底部居中
)
subtitle.add_animation(TextOutro.故障闪动, duration=tim("1s"))

# ========== 7. 组装与保存 ==========
script.add_segment(audio_seg, "bgm") \
      .add_segment(main_video, "main") \
      .add_segment(sticker, "overlay") \
      .add_segment(subtitle, "subtitle") \
      .save()

print(f"草稿创建完成，总时长: {script.duration}")
```

**设计模式总结**：pyJianYingDraft 采用**流畅接口（Fluent Interface）**设计，通过返回 `self` 支持链式调用，使得复杂的草稿构建能够以声明式、高可读性的代码完成。同时提供**便捷构造**（直接传路径）和**显式构造**（先创建素材）两种模式，在简单场景和精细控制场景间取得平衡。核心工作流遵循"初始化 → 创建草稿 → 添加轨道 → 创建片段 → 配置效果 → 组装保存"的顺序，与专业视频编辑软件的操作逻辑一致。
